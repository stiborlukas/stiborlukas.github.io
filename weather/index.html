<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="search-section">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search for a city..." autocomplete="off">
                <button class="search-btn">üîç</button>
            </div>
        </div>

        <div id="weather-content">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <script>
        class WeatherApp {
            constructor() {
                this.apiKey = '1970ba83e8c0664dd1766339eba8d0fe';
                this.searchInput = document.querySelector('.search-input');
                this.searchBtn = document.querySelector('.search-btn');
                this.weatherContent = document.getElementById('weather-content');
                
                this.initEventListeners();
                this.getCurrentLocationWeather();
            }

            initEventListeners() {
                this.searchBtn.addEventListener('click', () => this.handleSearch());
                this.searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.handleSearch();
                });
            }

            handleSearch() {
                const city = this.searchInput.value.trim();
                if (city) {
                    this.fetchWeatherByCity(city);
                }
            }

            showLoading() {
                this.weatherContent.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                `;
            }

            showError(message) {
                this.weatherContent.innerHTML = `
                    <div class="error">
                        <h3>Oops!</h3>
                        <p>${message}</p>
                    </div>
                `;
            }

            async fetchWeatherByCity(city) {
                this.showLoading();
                try {
                    const response = await fetch(
                        `https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${this.apiKey}`
                    );
                    
                    if (!response.ok) {
                        throw new Error('City not found');
                    }
                    
                    const data = await response.json();
                    await this.fetchDetailedWeather(data.coord.lat, data.coord.lon, data.name, data.sys.country);
                } catch (error) {
                    this.showError('City not found. Please try again.');
                }
            }

            async fetchDetailedWeather(lat, lon, cityName = '', country = '') {
                try {
                    const [weatherResponse, airQualityResponse] = await Promise.all([
                        fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&units=metric&appid=${this.apiKey}`),
                        fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${this.apiKey}`)
                    ]);
                    
                    const weatherData = await weatherResponse.json();
                    const airQualityData = await airQualityResponse.json();
                    
                    this.displayWeather(weatherData, airQualityData, cityName, country);
                } catch (error) {
                    console.error('Error fetching detailed weather:', error);
                    // Fallback to basic weather
                    this.fetchBasicWeather(lat, lon);
                }
            }

            async fetchBasicWeather(lat, lon) {
                try {
                    const response = await fetch(
                        `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${this.apiKey}`
                    );
                    const data = await response.json();
                    this.displayBasicWeather(data);
                } catch (error) {
                    this.showError('Unable to fetch weather data. Please try again.');
                }
            }

            displayWeather(data, airQualityData, cityName = '', country = '') {
                const current = data.current;
                const hourly = data.hourly.slice(1, 13);
                const daily = data.daily.slice(1, 6);
                const alerts = data.alerts || [];
                
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', { 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                });
                
                const dateString = now.toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    month: 'short', 
                    day: 'numeric' 
                });

                const locationName = cityName || this.getLocationName(data);
                const countryName = country || '';

                let content = `
                    <div class="weather-main">
                        <div class="location">${dateString}, ${timeString}</div>
                        <div class="location">${locationName}${countryName ? ', ' + countryName : ''}</div>
                        <div class="coordinates">üìç ${data.lat.toFixed(4)}¬∞, ${data.lon.toFixed(4)}¬∞</div>
                        
                        <div class="current-temp">${Math.round(current.temp)}¬∞C</div>
                        <img src="https://openweathermap.org/img/wn/${current.weather[0].icon}@2x.png" 
                             alt="Weather icon" class="weather-icon">
                        <div class="weather-desc">${current.weather[0].description}</div>
                        <div class="feels-like">Feels like ${Math.round(current.feels_like)}¬∞C</div>

                        <div class="weather-details">
                            <div class="detail-item">
                                <div class="detail-value">${current.humidity}%</div>
                                <div class="detail-label">Humidity</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${Math.round(current.wind_speed * 3.6)}</div>
                                <div class="detail-label">Wind km/h</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${current.pressure}</div>
                                <div class="detail-label">Pressure hPa</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${(current.visibility / 1000).toFixed(1)}</div>
                                <div class="detail-label">Visibility km</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${current.uvi.toFixed(1)}</div>
                                <div class="detail-label">UV Index</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${current.dew_point.toFixed(1)}¬∞</div>
                                <div class="detail-label">Dew Point</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${current.clouds}%</div>
                                <div class="detail-label">Cloudiness</div>
                            </div>
                            ${current.wind_deg !== undefined ? `
                            <div class="detail-item">
                                <div class="detail-value">${current.wind_deg}¬∞</div>
                                <div class="detail-label">Wind Dir</div>
                            </div>
                            ` : ''}
                        </div>

                        <div class="sun-times">
                            <div class="sun-item">
                                <div class="sun-icon">üåÖ</div>
                                <div class="sun-time">${new Date(current.sunrise * 1000).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}</div>
                                <div class="sun-label">Sunrise</div>
                            </div>
                            <div class="sun-item">
                                <div class="sun-icon">üåá</div>
                                <div class="sun-time">${new Date(current.sunset * 1000).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}</div>
                                <div class="sun-label">Sunset</div>
                            </div>
                        </div>
                    </div>
                `;

                // Weather Alerts
                if (alerts.length > 0) {
                    content += `
                        <div class="alerts-section">
                            <div class="forecast-title">‚ö†Ô∏è Weather Alerts</div>
                            ${alerts.map(alert => `
                                <div class="alert-item">
                                    <div class="alert-title">${alert.event}</div>
                                    <div class="alert-description">${alert.description.substring(0, 150)}...</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                // Air Quality
                if (airQualityData && airQualityData.list && airQualityData.list[0]) {
                    const aqi = airQualityData.list[0];
                    const aqiLabels = ['Good', 'Fair', 'Moderate', 'Poor', 'Very Poor'];
                    const aqiClasses = ['aqi-good', 'aqi-good', 'aqi-moderate', 'aqi-unhealthy', 'aqi-unhealthy'];
                    
                    content += `
                        <div class="air-quality">
                            <div class="forecast-title">üå¨Ô∏è Air Quality</div>
                            <div class="aqi-indicator">
                                <div class="aqi-value ${aqiClasses[aqi.main.aqi - 1]}">${aqi.main.aqi}</div>
                                <div>
                                    <div style="font-weight: 600;">${aqiLabels[aqi.main.aqi - 1]}</div>
                                    <div style="font-size: 12px; color: #666;">Air Quality Index</div>
                                </div>
                            </div>
                            <div class="weather-details">
                                <div class="detail-item">
                                    <div class="detail-value">${aqi.components.pm2_5.toFixed(1)}</div>
                                    <div class="detail-label">PM2.5 Œºg/m¬≥</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-value">${aqi.components.pm10.toFixed(1)}</div>
                                    <div class="detail-label">PM10 Œºg/m¬≥</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-value">${aqi.components.o3.toFixed(1)}</div>
                                    <div class="detail-label">O‚ÇÉ Œºg/m¬≥</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-value">${aqi.components.no2.toFixed(1)}</div>
                                    <div class="detail-label">NO‚ÇÇ Œºg/m¬≥</div>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // Hourly Forecast
                content += `
                    <div class="forecast-section">
                        <div class="forecast-title">‚è∞ Hourly Forecast</div>
                        <div class="forecast-container">
                            ${hourly.map(hour => {
                                const time = new Date(hour.dt * 1000);
                                const timeStr = time.toLocaleTimeString('en-US', { 
                                    hour: 'numeric', 
                                    hour12: true 
                                });
                                return `
                                    <div class="forecast-item">
                                        <div class="forecast-time">${timeStr}</div>
                                        <img src="https://openweathermap.org/img/wn/${hour.weather[0].icon}.png" 
                                             alt="Weather icon" class="forecast-icon">
                                        <div class="forecast-temp">${Math.round(hour.temp)}¬∞</div>
                                        <div class="forecast-details">
                                            ${Math.round(hour.pop * 100)}% üíß<br>
                                            ${Math.round(hour.wind_speed * 3.6)} km/h
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;

                // Daily Forecast
                content += `
                    <div class="daily-forecast">
                        <div class="forecast-title">üìÖ 5-Day Forecast</div>
                        ${daily.map(day => {
                            const date = new Date(day.dt * 1000);
                            const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                            return `
                                <div class="daily-item">
                                    <div class="daily-day">${dayName}</div>
                                    <img src="https://openweathermap.org/img/wn/${day.weather[0].icon}.png" 
                                         alt="Weather icon" class="daily-icon">
                                    <div class="daily-desc">${day.weather[0].description}</div>
                                    <div class="daily-temps">
                                        <div class="daily-high">${Math.round(day.temp.max)}¬∞</div>
                                        <div class="daily-low">${Math.round(day.temp.min)}¬∞</div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

                this.weatherContent.innerHTML = content;
            }

            displayBasicWeather(data) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', { 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                });
                
                const dateString = now.toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    month: 'short', 
                    day: 'numeric' 
                });

                this.weatherContent.innerHTML = `
                    <div class="weather-main">
                        <div class="location">${dateString}, ${timeString}</div>
                        <div class="location">${data.name}, ${data.sys.country}</div>
                        <div class="coordinates">üìç ${data.coord.lat.toFixed(4)}¬∞, ${data.coord.lon.toFixed(4)}¬∞</div>
                        
                        <div class="current-temp">${Math.round(data.main.temp)}¬∞C</div>
                        <img src="https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png" 
                             alt="Weather icon" class="weather-icon">
                        <div class="weather-desc">${data.weather[0].description}</div>
                        <div class="feels-like">Feels like ${Math.round(data.main.feels_like)}¬∞C</div>

                        <div class="weather-details">
                            <div class="detail-item">
                                <div class="detail-value">${data.main.humidity}%</div>
                                <div class="detail-label">Humidity</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${Math.round(data.wind.speed * 3.6)}</div>
                                <div class="detail-label">Wind km/h</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${data.main.pressure}</div>
                                <div class="detail-label">Pressure hPa</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${data.visibility ? (data.visibility / 1000).toFixed(1) : 'N/A'}</div>
                                <div class="detail-label">Visibility km</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-value">${data.clouds.all}%</div>
                                <div class="detail-label">Cloudiness</div>
                            </div>
                            ${data.wind.deg !== undefined ? `
                            <div class="detail-item">
                                <div class="detail-value">${data.wind.deg}¬∞</div>
                                <div class="detail-label">Wind Dir</div>
                            </div>
                            ` : ''}
                        </div>

                        <div class="sun-times">
                            <div class="sun-item">
                                <div class="sun-icon">üåÖ</div>
                                <div class="sun-time">${new Date(data.sys.sunrise * 1000).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}</div>
                                <div class="sun-label">Sunrise</div>
                            </div>
                            <div class="sun-item">
                                <div class="sun-icon">üåá</div>
                                <div class="sun-time">${new Date(data.sys.sunset * 1000).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}</div>
                                <div class="sun-label">Sunset</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            getLocationName(data) {
                return data.timezone.split('/')[1].replace('_', ' ') || 'Unknown Location';
            }

            getCurrentLocationWeather() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const { latitude, longitude } = position.coords;
                            this.fetchDetailedWeather(latitude, longitude);
                        },
                        () => {
                            // Default to Prague if geolocation fails
                            this.fetchWeatherByCity('Prague');
                        }
                    );
                } else {
                    this.fetchWeatherByCity('Prague');
                }
            }
        }

        // Initialize the app
        new WeatherApp();
    </script>
</body>
</html>